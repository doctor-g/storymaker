<link rel="import"
      href="../../bower_components/polymer/polymer-element.html">
<link rel="import"
      href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import"
      href="../../bower_components/paper-button/paper-button.html">

<link rel="import"
      href="content-button-editor.html">
<link rel="import"
      href="content-if-editor.html">
<link rel="import"
      href="content-text-editor.html">

<dom-module id="content-editor">
    <template>
        <style>
             :host {
                display: block;
            }
        </style>
        <div id="buttonbar">
            <paper-button raised
                          on-tap="_addTextContent">Add Text</paper-button>
            <paper-button raised
                          on-tap="_addButton">Add Button</paper-button>
            <paper-button raised
                          on-tap="_addIf"
                          disabled$="[[!__areThereVariables(game.variables)]]">Add If</paper-button>
        </div>

        <template is="dom-repeat"
                  items="{{content}}">
            <iron-pages selected="[[item.type]]"
                        attr-for-selected="type">
                <content-text-editor type="text"
                                     item="{{item}}"></content-text-editor>
                <content-button-editor type="button"
                                       item="{{item}}"
                                       game="[[game]]"></content-button-editor>
                <content-if-editor type="if"
                                   item="{{item}}"
                                   game="[[game]]"></content-if-editor>
            </iron-pages>
        </template>
    </template>

    <script>
        class ContentEditor extends Polymer.Element {
            static get is() { return 'content-editor'; }
            static get properties() {
                return {
                    content: {
                        type: Array,
                        notify: true
                    },
                    game: Object
                };
            }

            _addTextContent() {
                this.push('content',
                    {
                        type: 'text',
                        value: ''
                    }
                );
            }

            _addButton() {
                this.push('content',
                    {
                        type: 'button',
                        text: '',
                        actions: []
                    })
            }

            _addIf() {
                const firstVarKey = Object.keys(this.game.variables)[0];
                this.push('content',
                    {
                        type: 'if',
                        condition: '=',
                        variable: firstVarKey,
                        value: '0',
                        content: []
                    });
            }

            __areThereVariables(variables) {
                return Object.keys(variables).length > 0;
            }
        }

        window.customElements.define(ContentEditor.is, ContentEditor);
    </script>
</dom-module>